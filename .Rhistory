maiz.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/maize_HarvAreaYield_Geotiff/maize_YieldPerHectare.tif')
maiz <- crop(maiz, enm)
maiz.yld <- crop(maiz.yld, enm)
all.yld <- maiz.yld + mill.yld + sorg.yld
tmp <- meta %>% group_by(locality,host) %>% summarize(Emg = mean(emergence), lat = mean(lat), lon=mean(lon))
tmp$productivity <- raster::extract(all.yld, cbind.data.frame(tmp$lon, tmp$lat))
tmp.wide <- as.data.frame(tmp %>% pivot_wider(names_from=host, values_from=Emg))
tmp.wide$spec <- NULL
for (i in 1:nrow(tmp.wide)){
highest <- max(tmp.wide[i,5:7])
sec_highest <- sort(tmp.wide[i,5:7],partial=2)[2]
min_val <- min(tmp.wide[i,5:7])
tmp.wide$pdi[i] <- ((highest - sec_highest) + (highest - min_val))/2
}
tmp.wide$pdi <- as.numeric(tmp.wide$pdi)
tmp <- meta %>% group_by(locality,host) %>% summarize(Emg = mean(emergence), lat = mean(lat), lon=mean(lon))
################  load gps points for experimental studies
meta <- read.csv('/Users/emilywork/Documents/GitHub/StrigaMacroecologyMS/SI.dat.1.30.20.csv')
meta <- subset(meta, emergence != "NA") # 27 localities
tmp <- meta %>% group_by(locality,host) %>% summarize(Emg = mean(emergence), lat = mean(lat), lon=mean(lon))
tmp$productivity <- raster::extract(all.yld, cbind.data.frame(tmp$lon, tmp$lat))
tmp.wide <- as.data.frame(tmp %>% pivot_wider(names_from=host, values_from=Emg))
tmp.wide$spec <- NULL
for (i in 1:nrow(tmp.wide)){
highest <- max(tmp.wide[i,5:7])
sec_highest <- sort(tmp.wide[i,5:7],partial=2)[2]
min_val <- min(tmp.wide[i,5:7])
tmp.wide$pdi[i] <- ((highest - sec_highest) + (highest - min_val))/2
}
tmp.wide$pdi <- as.numeric(tmp.wide$pdi)
tmp.wide <- na.omit(tmp.wide)
tmp.wide
tmp.wide <- as.data.frame(tmp %>% pivot_wider(names_from=host, values_from=Emg))
tmp.wide$spec <- NULL
for (i in 1:nrow(tmp.wide)){
highest <- max(tmp.wide[i,5:7])
sec_highest <- sort(tmp.wide[i,5:7],partial=2)[2]
min_val <- min(tmp.wide[i,5:7])
tmp.wide$pdi[i] <- ((highest - sec_highest) + (highest - min_val))/2
}
tmp.wide$pdi <- as.numeric(tmp.wide$pdi)
tmp.wide$pdi <- as.numeric(tmp.wide$pdi)
tmp.wide
tmp.wide <- na.omit(tmp.wide)
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("Difference in relative emergence \non two best hosts") + xlab("Total yield per hectare") + geom_smooth(method ="lm")
library(raster)
library(maptools)
library(maps)
data(worldMapEnv)
cly <- raster('/Users/emilywork/Desktop/all_occ_model/CLYPPT_M_sl2_250.tif')
cly <- raster('/Users/emilywork/Desktop/all_occ_model/CLYPPT_M_sl2_250m.tif')
plot(cly)
################ downsample enm layer resolution to match earthstat
enm <- raster('/Users/emilywork/Downloads/all.CLY250.tif')
cly <- crop(cly, enm)
plot(cly)
map(database="world", xlim=c(-20,60),ylim=c(-40,45),add=T, col="grey40", lwd=0.5, mar=NA)
setwd("~/Documents/GitHub/StrigaMacroecologyMS")
library(raster)
library(maptools)
data(wrld_simpl)
library(raster)
library(dplyr)
library(rgdal)
library(dismo)
library(maps)
data(worldMapEnv)
library(viridis)
library(ggplot2)
library(tidyr)
library(lme4)
library(pals)
library(rgeos)
enm <- raster('/Users/emilywork/Downloads/all.CLY250.tif')
enm <- aggregate(enm, fact=10)
################ read in the production maps from earthstat
sorg <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/sorghum_HarvAreaYield_Geotiff/sorghum_HarvestedAreaHectares.tif')
sorg.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/sorghum_HarvAreaYield_Geotiff/sorghum_YieldPerHectare.tif')
sorg <- crop(sorg, enm)
sorg.yld <- crop(sorg.yld, enm)
mill <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/millet_HarvAreaYield_Geotiff/millet_HarvestedAreaHectares.tif')
mill.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/millet_HarvAreaYield_Geotiff/millet_YieldPerHectare.tif')
mill <- crop(mill, enm)
mill.yld <- crop(mill.yld, enm)
maiz <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/maize_HarvAreaYield_Geotiff/maize_HarvestedAreaHectares.tif')
maiz.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/maize_HarvAreaYield_Geotiff/maize_YieldPerHectare.tif')
maiz <- crop(maiz, enm)
maiz.yld <- crop(maiz.yld, enm)
all.yld <- maiz.yld + mill.yld + sorg.yld
all.yld <- maiz.yld + mill.yld + sorg.yld
tmp <- meta %>% group_by(locality,host) %>% summarize(Emg = mean(emergence), lat = mean(lat), lon=mean(lon))
tmp$productivity <- raster::extract(all.yld, cbind.data.frame(tmp$lon, tmp$lat))
tmp.wide <- as.data.frame(tmp %>% pivot_wider(names_from=host, values_from=Emg))
tmp.wide$spec <- NULL
for (i in 1:nrow(tmp.wide)){
highest <- max(tmp.wide[i,5:7])
sec_highest <- sort(tmp.wide[i,5:7],partial=2)[2]
min_val <- min(tmp.wide[i,5:7])
tmp.wide$pdi[i] <- ((highest - sec_highest) + (highest - min_val))/2
}
tmp.wide$pdi <- as.numeric(tmp.wide$pdi)
tmp.wide <- na.omit(tmp.wide)
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("Difference in relative emergence \non two best hosts") + xlab("Total yield per hectare") + geom_smooth(method ="lm")
summary(lm(pdi ~ productivity, data=tmp.wide))
### extract productivity
all.yld <- maiz.yld + mill.yld + sorg.yld
tmp <- meta %>% group_by(locality,host) %>% summarize(Emg = mean(emergence), lat = mean(lat), lon=mean(lon))
meta <- read.csv('/Users/emilywork/Documents/GitHub/StrigaMacroecologyMS/SI.dat.1.30.20.csv')
meta <- subset(meta, emergence != "NA") # 27 localities
tmp <- meta %>% group_by(locality,host) %>% summarize(Emg = mean(emergence), lat = mean(lat), lon=mean(lon))
tmp$productivity <- raster::extract(all.yld, cbind.data.frame(tmp$lon, tmp$lat))
tmp.wide <- as.data.frame(tmp %>% pivot_wider(names_from=host, values_from=Emg))
tmp.wide$spec <- NULL
for (i in 1:nrow(tmp.wide)){
highest <- max(tmp.wide[i,5:7])
sec_highest <- sort(tmp.wide[i,5:7],partial=2)[2]
min_val <- min(tmp.wide[i,5:7])
tmp.wide$pdi[i] <- ((highest - sec_highest) + (highest - min_val))/2
}
tmp.wide$pdi <- as.numeric(tmp.wide$pdi)
tmp.wide <- na.omit(tmp.wide)
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("Difference in relative emergence \non two best hosts") + xlab("Total yield per hectare") + geom_smooth(method ="lm")
summary(lm(pdi ~ productivity, data=tmp.wide))
tmp.wide
order(tmp.wide, pdi)
order(tmp.wide$pdi)
arrange(tmp.wide$pdi)
arrange(tmp.wide, pdi)
arrange(tmp.wide, -pdi)
hist(tmp.wide$pdi)
median(tmp.wide$pdi)
tmp <- meta %>% select(locality, emergence, host) %>% group_by(locality, host) %>% summarize(emg = mean(emergence))
tmp2 <- tmp %>% group_by(locality) %>% summarize(total=sum(emg))
tmp3 <- inner_join(tmp, tmp2)
tmp3$locality <- factor(tmp3$locality, levels = c("Bambey", "Maradi", "Mintimbougou","FarakoBa","SinthionMaleme","Samaru","AbuNaama","Kamboinse","Kobo","Yendi","Tamale","WadMedani","Galadima","Bakura","Damaturu","Jibiya","Andre","Kankia","Bida","Gombe","Gumi","Busia","Gwoza","Mokwa","Ngezima","Kazgail","Obeid"))
p <- ggplot(tmp3, aes(x=locality, y=emg, col=host, fill=host)) + geom_bar(position="stack", stat="identity", alpha=0.4) +theme_minimal()+ scale_colour_manual(values=c('gold2','plum','sienna3'), name="Host") + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ theme(axis.text.x=element_text(angle=90, vjust=0.4, hjust=1), legend.position="top",panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + ylab("Relative emergence") + xlab("")
p <- p + geom_vline(xintercept=2.5, lwd=0.3, lty=2) + geom_vline(xintercept=5.5, lwd=0.3, lty=2) + geom_vline(xintercept=12.5, lwd=0.3, lty=2) +  geom_vline(xintercept=15.5, lwd=0.3, lty=2) + annotate('text', x=26, y = 1.7, label="*", size=7)+ annotate('text', x=27, y = 1.7, label="*", size=7)
p
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("Difference in relative emergence \non two best hosts") + xlab("Total yield per hectare") + geom_smooth(method ="lm")
tmp.wide
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm")
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm")+theme_minimal()
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm")+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm")+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
arrange(tmp.wide, -pdi)
arrange(tmp.wide, -productivity)
hist(pdi)
hist(tmp$pdi)
hist(tmp.wide$pdi)
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm")+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="red")+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
library(cowplot)
p <- ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
plot_grid(p,q, labels=c('A','B'))
p <- ggplot(tmp.wide, aes(x=log(productivity), y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
p
p <- ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
p
summary(lm(pdi ~ productivity, data=tmp.wide))
summary(lm(pdi ~ log(productivity), data=tmp.wide))
summary(lm(log(pdi) ~ productivity, data=tmp.wide))
summary(lm(pdi ~ productivity, data=tmp.wide))
plot(enm)
enm.s <- raster('/Users/emilywork/Downloads/sorg.CLY250.tif')
enm.s <- aggregate(enm.s, fact=10)
enm.z <- raster('/Users/emilywork/Downloads/maiz.CLY250.tif')
enm.z <- aggregate(enm.z, fact=10)
enm.m <- raster('/Users/emilywork/Downloads/mill.CLY250.tif')
enm.m <- aggregate(enm.m, fact=10)
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
projection(shgeo) <- CRS('+proj=longlat +datum=WGS84')
shgeo
### habitat suitability at location of all S. hermonthica occurrences
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
head(shgeo)
nrow(sgeo)
nrow(shgeo)
r
enm.m
acsel <- gridSample(shgeo, enm, n=1)
coordinates(shgeo) <- ~lon+lat
acsel <- gridSample(shgeo, enm, n=1)
nrow(acsel)
r <- enm
res(r) <- 0.1
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
nrow(acsel)
r
enm
### habitat suitability at location of all S. hermonthica occurrences
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
r <- enm
res(r) <- 0.1
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
nrow(acsel)
res(r) <- 0.01 #0.1 degree ~ 11 km
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
nrow(acsel)
res(r) <- 0.1 #0.1 degree ~ 11 km
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
acsel$hs.s <- extract(enm.s, acsel)
acsel$hs.s <- raster::extract(enm.s, acsel)
acsel
head(acsel)
?extract
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
r <- enm
res(r) <- 0.1 #0.1 degree ~ 11 km
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
acsel$hs.s <- raster::extract(enm.s, acsel)
acsel
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
r <- enm
res(r) <- 0.1 #0.1 degree ~ 11 km
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
acsel
acsel<- as.data.frame(acsel)
acsel
head(acsel)
acsel$hs.s <- raster::extract(enm.s, acsel)
head(acsel)
acsel$hs.z <- raster::extract(enm.z, acsel)
acsel$hs.m <- raster::extract(enm.m, acsel)
acsel$hs.z <- raster::extract(enm.z, acsel)
acsel$hs.z <- raster::extract(cbind.data.drame(c(enm.z$lon, enm.z$lat) acsel)
acsel$hs.z <- raster::extract(cbind.data.drame(c(enm.z$lon, enm.z$lat), acsel)
)
acsel$hs.z <- raster::extract(cbind.data.frame(c(enm.z$lon, enm.z$lat)), acsel)
acsel$hs.z <- raster::extract(enm.z, cbind.data.frame(acsel$lon, acsel$lat))
acsel$hs.m <- raster::extract(enm.m, cbind.data.frame(acsel$lon, acsel$lat))
head(acsel)
acsel$prod <- raster::extract(all.yld, cbind.data.frame(acsel$lon, acsel$lat))
head(acsel)
pivot_longer(acsel, hs.s:hs.m)
acsel.long <- pivot_longer(acsel, hs.s:hs.m)
p <- ggplot(acsel.long, aes(x=prod, y=value, col=name)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
p
p <- ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point(size=3, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
q
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point(size=3, alpha=0.5) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
q
acsel <- gridSample(shgeo, r, n=1)
acsel<- as.data.frame(acsel)
acsel$hs.s <- raster::extract(enm.s, acsel)
acsel$hs.z <- raster::extract(enm.z, cbind.data.frame(acsel$lon, acsel$lat))
acsel$hs.m <- raster::extract(enm.m, cbind.data.frame(acsel$lon, acsel$lat))
acsel$prod <- raster::extract(all.yld, cbind.data.frame(acsel$lon, acsel$lat))
acsel.long <- pivot_longer(acsel, hs.s:hs.m)
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point(size=3, alpha=0.5) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
q
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
q
sorg.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/sorghum_HarvAreaYield_Geotiff/sorghum_YieldPerHectare.tif')
sorg.yld <- crop(sorg.yld, enm)
mill.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/millet_HarvAreaYield_Geotiff/millet_YieldPerHectare.tif')
mill.yld <- crop(mill.yld, enm)
maiz.yld <- raster('/Users/emilywork/Desktop/StrigaMacroecology/EarthStat/maize_HarvAreaYield_Geotiff/maize_YieldPerHectare.tif')
maiz.yld <- crop(maiz.yld, enm)
all.yld <- maiz.yld + mill.yld + sorg.yld
acsel<- as.data.frame(acsel)
acsel$hs.s <- raster::extract(enm.s, acsel)
acsel$hs.z <- raster::extract(enm.z, cbind.data.frame(acsel$lon, acsel$lat))
acsel$hs.m <- raster::extract(enm.m, cbind.data.frame(acsel$lon, acsel$lat))
acsel$prod <- raster::extract(all.yld, cbind.data.frame(acsel$lon, acsel$lat))
?raster::extract
hs.s <- raster::extract(enm.s, acsel)
hs.z <- raster::extract(enm.z, acsel)
hs.m <- raster::extract(enm.m, acsel)
acsel <- gridSample(shgeo, r, n=1)
#acsel<- as.data.frame(acsel)
hs.s <- raster::extract(enm.s, acsel)
hs.z <- raster::extract(enm.z, acsel)
hs.m <- raster::extract(enm.m, acsel)
prod <- raster::extract(all.yld, acsel)
acsel <- cbind.data.frame(hs.s, hs.z, hs.m, prod)
acsel.long <- pivot_longer(acsel, hs.s:hs.m)
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
q
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,5))
q
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
r <- enm
res(r) <- 0.01 #0.1 degree ~ 11 km
r <- extend(r, extent(r)+1)
acsel <- gridSample(shgeo, r, n=1)
hs.s <- raster::extract(enm.s, acsel)
hs.z <- raster::extract(enm.z, acsel)
hs.m <- raster::extract(enm.m, acsel)
prod <- raster::extract(all.yld, acsel)
acsel <- cbind.data.frame(hs.s, hs.z, hs.m, prod)
acsel.long <- pivot_longer(acsel, hs.s:hs.m)
q <- ggplot(acsel.long, aes(x=prod, y=value, col=name, group=name)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,5))
q
### habitat suitability at location of all S. hermonthica occurrences
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
head(shgeo)
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
coordinates(shgeo) <- ~lon+lat
sh.s <- subset(shgeo, sorhum==1)
sh.s <- subset(shgeo, sorghum==1)
sh.s
sh.z <- subset(shgeo, maize==1)
sh.m <- subset(shgeo, millet==1)
r <- enm
res(r) <- 0.01 #0.1 degree ~ 11 km
r <- extend(r, extent(r)+1)
acsel.s <- gridSample(sh.s, r, n=1)
nrow(acsel.s)
acsel.s <- gridSample(sh.s, r, n=1)
acsel.z <- gridSample(sh.z, r, n=1)
acsel.m <- gridSample(sh.m, r, n=1)
acsel.s <- gridSample(sh.s, r, n=1)
acsel.z <- gridSample(sh.z, r, n=1)
acsel.m <- gridSample(sh.m, r, n=1)
nrow(acsel.z)
nrow(acsel.m)
acsel.m
head(acsel.m)
acsel.s$hs <- raster::extract(enm.s, acsel.s)
acsel.s
hs <- raster::extract(enm.s, acsel.s)
hs <- raster::extract(enm.s, acsel.s)
acsel.s <- gridSample(sh.s, r, n=1)
hs <- raster::extract(enm.s, acsel.s)
hs
acsel.s
acsel.s[3]
acsel.s[,3]
acsel.s <- as.data.frame(acsel.s)
hs <- raster::extract(enm.s, acsel.s)
acsel.s <- as.data.frame(acsel.s)
acsel.s$host <- "sorghum"
acsel.s$hs <- hs
head(acsel.s)
hs <- raster::extract(enm.z, acsel.z)
acsel.z <- as.data.frame(acsel.z)
acsel.z$host <- "maize"
acsel.z$hs <- hs
acsel.z
hs <- raster::extract(enm.m, acsel.m)
acsel.m <- as.data.frame(acsel.m)
acsel.m$host <- "millet"
acsel.m$hs <- hs
acsel.m
acsel <- cbind.data.frame(acsel.s, acsel.z, acsel.m)
acsel <- rbind.data.frame(acsel.s, acsel.z, acsel.m)
acsel
tail(acsel)
acsel$prod <- raster::extract(all.yld, cbind(acsel$lon,acsel$lat))
head(acsel)
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,5))
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5))
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point() + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.5) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth()+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth(se=F)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth(se=F, lwd=3)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth(se=F, lwd=2.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth(se=F, lwd=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q <- ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth(se=F, lwd=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
plot_grid(p,q, labels=c('A','B'))
q <- ggplot(acsel, aes(x=prod, y=hs, col=host, group=host)) + geom_point(alpha=0.7) + ylab("Habitat Suitability") + xlab("Total yield per hectare") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, group=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Host Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, group=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Host Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, group=host, col=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Host Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, group=host, col=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Host Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_col_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Host Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_col_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Host Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.7, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
plot_grid(p,q, labels=c('A','B'))
p <- ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("PDI") + xlab("Total yield per hectare") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
plot_grid(p,q, labels=c('A','B'))
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
dev.off()
p <- ggplot(tmp.wide, aes(x=productivity, y=pdi)) + geom_point(size=2, alpha=0.5) + ylab("PDI") + xlab("Productivity") + geom_smooth(method ="lm", col="black", lty=2)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21) + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=3, width=6.8)
dev.off()
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, col="black") + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
plot_grid(p,q, labels=c('A','B'))
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.25, pch=21, size=0.75) + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
plot_grid(p,q, labels=c('A','B'))
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=2, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=1.75, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()) + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, labels=c('A','B'))
dev.off()
?plot_grid
plot_grid(p,q, labels=c('A','B'), align="v")
plot_grid(p,q, labels=c('A','B'), align="v")
?plot_grid
plot_grid(p,q, labels=c('A','B'), align="v", axis="l")
plot_grid(p,q, labels=c('A','B'), align="v", axis="l")
plot_grid(p,q, labels=c('A','B'), align="v", axis="r")
?plot_grid
plot_grid(p,q, align="v", axis="r", labels=c('A','B'))
?plot_grid
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
pdf(file="ProductivityFig", height=3, width=6.8)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
dev.off()
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Parasite Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=1.75, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), legend.position = "bottom") + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Habitat Suitability") + xlab("Productivity") + geom_smooth(se=F, lwd=1.75, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), legend.position = "bottom") + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Habitat\nSuitability") + xlab("Productivity") + geom_smooth(se=F, lwd=1.75, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), legend.position = "bottom") + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Parasite HS") + xlab("Productivity") + geom_smooth(se=F, lwd=1.75, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), legend.position = "bottom") + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
dev.off()
q <- ggplot(acsel, aes(x=prod, y=hs, fill=host, col=host)) + geom_point(alpha=0.5, pch=21, size=0.75) + ylab("Parasite HS") + xlab("Productivity") + geom_smooth(se=F, lwd=1.75, alpha=0.5)+theme_minimal()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), legend.position = "top") + xlim(c(0,6.5)) + scale_fill_manual(values=c('gold2','plum','sienna3'), name="Host")+ scale_color_manual(values=c('gold2','plum','sienna3'), name="Host")
q
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1)
dev.off()
?plot_grid
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1, rel_heights = c(0.8,1))
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1, rel_heights = c(0.8,1))
dev.off()
pdf(file="ProductivityFig", height=5, width=3.22)
plot_grid(p,q, align="v", axis="r", labels=c('A','B'), cols=1, rel_heights = c(0.7,1))
dev.off()
library(raster)
library(maps)
sorg <- raster('/Users/ebellis/Desktop/Projects/StigaxSorghum/MacroecologyMS/Fig1/sorg.CLY250.tif')
#all <- raster('/Users/ebellis/Desktop/Projects/StigaxSorghum/MacroecologyMS/Fig1/all.CLY250.tif')
maiz <- raster('/Users/ebellis/Desktop/Projects/StigaxSorghum/MacroecologyMS/Fig1/maiz.CLY250.tif')
maiz <- raster('/Users/emilywork/Downloads/maiz.CLY250.tif')
sorg <- raster('/Users/emilywork/Downloads/sorg.CLY250.tif')
mill <- raster('/Users/emilywork/Downloads/mill.CLY250.tif')
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
sh.mill <- subset(shgeo, millet==1)
sh.sorg <- subset(shgeo, sorghum==1)
sh.maiz <- subset(shgeo, maize==1)
##if need a cut-off, hs >0.5 should be good
mill.hs <- extract(mill, cbind(sh.mill$lon,sh.mill$lat))
##if need a cut-off, hs >0.5 should be good
mill.hs <- raster::extract(mill, cbind(sh.mill$lon,sh.mill$lat))
sorg.hs <- raster::extract(sorg, cbind(sh.sorg$lon,sh.sorg$lat))
maiz.hs <- raster::extract(maiz, cbind(sh.maiz$lon,sh.maiz$lat))
all.hs <- raster::extract(all, cbind(shgeo$lon,shgeo$lat))
all.hs <- raster::extract(all, cbind(shgeo$lon,shgeo$lat))
shgeo <- read.csv('/Users/emilywork/Downloads/pnas.1908707117.sd03.csv', header=T)
all.hs <- raster::extract(all, cbind(shgeo$lon,shgeo$lat))
library(dismo)
library(raster)
library(gdalUtils)
library(rgdal)
library(ggplot2)
install.packages("gdalUtils")
library(gdalUtils)
#core habitat
core.mill <- calc(mill, fun=function(x){ x[x < 0.2] <- NA; return(x)} )
core.sorg <- calc(sorg, fun=function(x){ x[x < 0.2] <- NA; return(x)} )
core.maiz <- calc(maiz, fun=function(x){ x[x < 0.2] <- NA; return(x)} )
#get data for each environment, mask based on HSS
env <- raster("/Users/ebellis/Desktop/Projects/StigaxSorghum/MacroecologyMS/env7.rs.tif")
